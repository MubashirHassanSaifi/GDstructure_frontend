"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("tslib"),r=require("espree"),n=e(require("path")),s=e(require("remark-mdx")),o=e(require("remark-parse")),i=e(require("unified")),a=["@typescript-eslint/parser","babel-eslint"],u=["JSXElement","JSXFragment"],p=function(e){return u.includes(e.type)},l=function(e){if(e){if("string"==typeof e&&(e=require(e)),"object"==typeof e&&(e="parseForESLint"in e&&e.parseForESLint||"parse"in e&&e.parse),"function"!=typeof e)throw new TypeError("Invalid custom parser for `eslint-mdx`: "+e);return[e]}for(var t=[r.parse],n=0,s=a;n<s.length;n++){var o=s[n];try{var i=require(o),u="parseForESLint"in i?i.parseForESLint:i.parse;u&&t.unshift(u);break}catch(e){}}return t},c=function(e){var r=e.start.offset,n=e.end.offset;return{range:[r,n],loc:t.__assign({},e),start:r,end:n}};function f(e,r,n){if(!e||!e.loc||!e.range)return e;Object.entries(e).forEach((function(t){var s=t[0],o=t[1];o&&(Array.isArray(o)?e[s]=o.map((function(e){return f(e,r,n)})):e[s]=f(o,r,n))}));var s=e.loc,o=s.start,i=s.end,a=e.range,u=a[0]+n,p=a[1]+n;return t.__assign(t.__assign({},e),{start:u,end:p,range:[u,p],loc:{start:{line:r+o.line,column:o.column},end:{line:r+i.line,column:i.column}}})}var m=function(e){return e&&e[e.length-1]},x=function(e,t){return t.every((function(t){return t in e}))},h="(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*"+("(?:[^\"'=<>`\\u0000-\\u0020]+|'[^']*'|\"[^\"]*\"|"+"{.*}".replace(".","[\0-ï¿¿]")+")")+")?)",d="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+h+"*\\s*>",_="<\\s*\\/[A-Za-z]*[A-Za-z0-9\\.\\-]*\\s*>",E="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+h+"*\\s*\\/?>",v="\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e",g=new RegExp("^(?:"+d+")$"),y=new RegExp("^(?:"+_+")$"),S=new RegExp("^(?:"+d+"[\\s\\S]*"+_+")$"),T=new RegExp("^(?:"+E+")$"),N=new RegExp("^(?:"+v+")$"),b=new RegExp("(\x3c!---*)([\\s\\S]*?)(-*--\x3e)","g"),A=function(e){return g.test(e)},L=function(e){return y.test(e)},O=function(e){return N.test(e)},P=function(e){return S.test(e)},R=function(e){return T.test(e)},C=function(){function e(e){var t=e.enter;this._enter=t}return e.prototype.combineLeftJsxNodes=function(e){return{type:"jsx",data:e[0].data,value:e.reduce((function(e,t){return e+t.value}),""),position:{start:e[0].position.start,end:m(e).position.end}}},e.prototype.combineJsxNodes=function(e,t){var r=this,n=0,s=[],o=e.length;return e.reduce((function(e,i,a){if("jsx"===i.type){var u=i.value;if(A(u))n++,s.push(i);else{if(L(u))n--,s.push(i);else if(O(u)||R(u)||P(u))s.push(i);else try{var p=Z.normalizeJsxNode(i,t);s.push.apply(s,Array.isArray(p)?p:[p])}catch(e){var l=i.position.start;throw Object.assign(new SyntaxError("unknown jsx node: "+JSON.stringify(u)),{lineNumber:l.line,column:l.column,index:l.offset})}if(!n){var c=s.findIndex((function(e){return A(e.value)}));-1===c?e.push.apply(e,s):(e.push.apply(e,s.slice(0,c)),e.push(r.combineLeftJsxNodes(s.slice(c)))),s.length=0}}}else n?s.push(i):e.push(i);return a===o-1&&s.length>0&&e.push(r.combineLeftJsxNodes(s)),e}),[])},e.prototype.traverse=function(e,t){var r=this;if(e){var n=e.children;if(n){var s=e;(n=e.children=this.combineJsxNodes(n,s)).forEach((function(e){return r.traverse(e,s)}))}this._enter(e,t)}},e}(),J=function(e,t){return new C(t).traverse(e)},w=i().use(o).use(s).freeze(),F=["body","comments","tokens"],j=["export","import","jsx"],z=["column","index","lineNumber"],X=[".mdx"],G=[".md"],M={comment:!0,ecmaFeatures:{jsx:!0},ecmaVersion:(new Date).getUTCFullYear(),sourceType:"module",tokens:!0,filePath:"__placeholder__.mdx"},k="<$>".length,q=function(){function e(){this._options=M,this.parse=this.parse.bind(this),this.parseForESLint=this.parseForESLint.bind(this)}return e.prototype.normalizeJsxNode=function(e,r,n){void 0===n&&(n=this._options);var s=e.value;if("jsx"!==e.type||O(s))return e;if(b.exec(s)){var o=[],i=e.position.start,a=i.line,u=i.column,p=i.offset;Object.assign(e,{data:t.__assign(t.__assign({},e.data),{jsxType:"JSXElementWithHTMLComments",comments:o,inline:!!r&&"root"!==r.type}),value:s.replace(b,(function(e,t,r,n,i){var l=i+e.length,c=s.slice(0,i).split("\n"),f=s.slice(0,l).split("\n"),x="{/"+"*".repeat(t.length-2)+r+"*".repeat(n.length-2)+"/}",h=c.length-1,d=f.length-1;return o.push({fixed:x,loc:{start:{line:a+h,column:m(c).length+(h?0:u-1),offset:p+i},end:{line:a+d,column:m(f).length+(d?0:u-1),offset:p+l}},origin:e}),x}))})}return this._normalizeJsxNodes(e,n)},e.prototype.parse=function(e,t){return this.parseForESLint(e,t).ast},e.prototype.parseForESLint=function(e,r){var s=this,o=n.extname(r.filePath),i=X.concat(r.extensions||[]).includes(o),a=G.concat(r.markdownExtensions||[]).includes(o);if(!i&&!a)return this._eslintParse(e,r);var u=w.parse(e);return this._ast=t.__assign(t.__assign({},c(u.position)),{type:"Program",sourceType:r.sourceType||"module",body:[],comments:[],tokens:[]}),this._services={JSXElementsWithHTMLComments:[]},i&&J(u,{enter:function(e,t){if(j.includes(e.type)){var n=s.normalizeJsxNode(e,t,r);(n=Array.isArray(n)?n:[n]).forEach((function(e){return s._nodeToAst(e,r)}))}}}),{ast:this._ast,services:this._services}},e.prototype._eslintParse=function(e,t){var r,n;this._parsers&&t.parser===this._options.parser||(this._parsers=l(t.parser)),t.filePath&&this._options!==t&&Object.assign(this._options,t);for(var s=0,o=this._parsers;s<o.length;s++){var i=o[s];try{r=i(e,this._options);break}catch(e){n||(n=e)}}if(!r&&n)throw n;return"ast"in r&&r.ast?r:{ast:r}},e.prototype._normalizeJsxNodes=function(e,t){var r,n=e.value;try{r=this._eslintParse("<$>"+n+"</$>",t).ast}catch(t){if(x(t,z)){var s=e.position.start;throw t.index+=s.offset-k,t.column=t.lineNumber>1?t.column:t.column+s.column-k,t.lineNumber+=s.line-1,t}return e}var o=r.body[0].expression;if(!p(o)||o.children.length<=1)return e;var i=e.position.start,a=i.line,u=i.offset;return o.children.reduce((function(t,r){if(!p(r))return t;var s=r.start,o=r.end,i=r.loc,l=void 0===i?{start:{column:s,line:1},end:{column:o,line:1}}:i,c=l.start,f=l.end,m=r.range,x=void 0===m?[s,o]:m,h=a+c.line-1,d=a+f.line-1,_=x[0]-k,E=x[1]-k;return t.push({type:"jsx",data:t.length>0?null:e.data,value:n.slice(_,E),position:{start:{line:h,column:a===h?c.column-k:c.column,offset:u+_},end:{line:d,column:a===h?f.column-k:f.column,offset:u+E}}}),t}),[])},e.prototype._nodeToAst=function(e,t){var r=this;e.data&&"JSXElementWithHTMLComments"===e.data.jsxType&&this._services.JSXElementsWithHTMLComments.push(e);var n=e.value;if(!O(n)){var s,o=c(e.position),i=o.loc,a=o.start,u=i.start.line-1;try{s=this._eslintParse(n,t).ast}catch(e){throw x(e,z)&&(e.index+=a,e.column=e.lineNumber>1?e.column:e.column+i.start.column,e.lineNumber+=u),e}var p=a-s.range[0];F.forEach((function(e){var t;return(t=r._ast[e]).push.apply(t,s[e].map((function(e){return f(e,u,p)})))}))}},e}(),Z=new q,$=Z.parse,I=Z.parseForESLint;exports.AST_PROPS=F,exports.CLOSE_TAG_REGEX=y,exports.COMMENT_CONTENT_REGEX=b,exports.COMMENT_REGEX=N,exports.DEFAULT_EXTENSIONS=X,exports.DEFAULT_PARSER_OPTIONS=M,exports.ES_NODE_TYPES=j,exports.FALLBACK_PARSERS=a,exports.JSX_TYPES=u,exports.LOC_ERROR_PROPERTIES=z,exports.MARKDOWN_EXTENSIONS=G,exports.OPEN_CLOSE_TAG_REGEX=S,exports.OPEN_TAG_REGEX=g,exports.Parser=q,exports.SELF_CLOSING_TAG_REGEX=T,exports.Traverse=C,exports.closeTag=_,exports.comment=v,exports.commentClose="(-*--\x3e)",exports.commentOpen="(\x3c!---*)",exports.first=function(e){return e&&e[0]},exports.hasProperties=x,exports.isCloseTag=L,exports.isComment=O,exports.isJsxNode=p,exports.isOpenCloseTag=P,exports.isOpenTag=A,exports.isSelfClosingTag=R,exports.last=m,exports.mdxProcessor=w,exports.normalizeParser=l,exports.normalizePosition=c,exports.openTag=d,exports.parse=$,exports.parseForESLint=I,exports.parser=Z,exports.restoreNodeLocation=f,exports.selfClosingTag=E,exports.traverse=J;
